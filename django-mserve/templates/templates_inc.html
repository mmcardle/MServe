
<script type="j">
    RS={{STATIC_URL}}
</script>

<script id="userTemplate" type="text/x-jquery-tmpl">

    {%templatetag openvariable%}if !staff{%templatetag closevariable%}
    <h1>Resources you own</h1>
    
    <div id="user_mfilepager" ></div>
    <div id="user_mfilemessages"></div>
    <div id="user_mfileholder" ></div>

    <h1>Resources you have access to</h1>

    <div id="user_authpager"></div>
    <div id="user_authmessages"></div>
    <div id="user_authholder"></div>
    <div class="clr"></div>
    {%templatetag openvariable%}/if{%templatetag closevariable%}

    <table border="0" style="width: 80%">
    <tr>
        {%templatetag openvariable%}if !staff{%templatetag closevariable%}
        <td style="width:30%">
            <h1>Request a Service</h1>
            <div id="user-request-service" >
                <form id="user-request-service-form"  >
                    <div id="user-request-service-form-errors" style="color:red;font-weight: bold"></div>
                    {{ servicerequestform.as_p }}
                </form>

                <button id="user-request-service-button"  >Request a Service</button>
            </div>
        </td>
        {%templatetag openvariable%}/if{%templatetag closevariable%}

        <td style="width:35%">
            <h1>Pending Requests</h1>
            <div id="pending-requests"></div>
        </td>

        <td style="width:35%">
            <h1>Requests</h1>
            <div id="done-requests"></div>
        </td>
     </tr>
    </table>
    <div class="clr"></div>

</script>

<script id="template-upload" type="text/x-jquery-tmpl">
    <tr class="template-upload{%templatetag openvariable%}if error{%templatetag closevariable%} ui-state-error{%templatetag openvariable%}/if{%templatetag closevariable%}">
        <td class="preview"></td>
        <th class="name">{%templatetag openvariable%}if name{%templatetag closevariable%}
                            ${name}
                         {%templatetag openvariable%}else{%templatetag closevariable%}
                            Untitled
                         {%templatetag openvariable%}/if{%templatetag closevariable%}
        </th>
        <td class="size">${sizef}</td>
        {%templatetag openvariable%}if error{%templatetag closevariable%}
            <td class="error" colspan="2">Error:
                {%templatetag openvariable%}if error === 'maxFileSize'{%templatetag closevariable%}File is too big
                {%templatetag openvariable%}else error === 'minFileSize'{%templatetag closevariable%}File is too small
                {%templatetag openvariable%}else error === 'acceptFileTypes'{%templatetag closevariable%}Filetype not allowed
                {%templatetag openvariable%}else error === 'maxNumberOfFiles'{%templatetag closevariable%}Max number of files exceeded
                {%templatetag openvariable%}else{%templatetag closevariable%}${error}
                {%templatetag openvariable%}/if{%templatetag closevariable%}
            </td>
        {%templatetag openvariable%}else{%templatetag closevariable%}
            <td class="progress"><div></div></td>
            <td class="start"><button>Start</button></td>
        {%templatetag openvariable%}/if{%templatetag closevariable%}
        <td class="cancel"><button>Cancel</button></td>
    </tr>
</script>


<script id="template-download" type="text/x-jquery-tmpl">
    <tr class="template-download{%templatetag openvariable%}if error{%templatetag closevariable%} ui-state-error{%templatetag openvariable%}/if{%templatetag closevariable%}">
        {%templatetag openvariable%}if error{%templatetag closevariable%}
            <td></td>
            <td class="name">${name}</td>
            <td class="size">${sizef}</td>
            <td class="error" colspan="2">Error:
                {%templatetag openvariable%}if error === 1{%templatetag closevariable%}File exceeds upload_max_filesize (php.ini directive)
                {%templatetag openvariable%}else error === 2{%templatetag closevariable%}File exceeds MAX_FILE_SIZE (HTML form directive)
                {%templatetag openvariable%}else error === 3{%templatetag closevariable%}File was only partially uploaded
                {%templatetag openvariable%}else error === 4{%templatetag closevariable%}No File was uploaded
                {%templatetag openvariable%}else error === 5{%templatetag closevariable%}Missing a temporary folder
                {%templatetag openvariable%}else error === 6{%templatetag closevariable%}Failed to write file to disk
                {%templatetag openvariable%}else error === 7{%templatetag closevariable%}File upload stopped by extension
                {%templatetag openvariable%}else error === 'maxFileSize'{%templatetag closevariable%}File is too big
                {%templatetag openvariable%}else error === 'minFileSize'{%templatetag closevariable%}File is too small
                {%templatetag openvariable%}else error === 'acceptFileTypes'{%templatetag closevariable%}Filetype not allowed
                {%templatetag openvariable%}else error === 'maxNumberOfFiles'{%templatetag closevariable%}Max number of files exceeded
                {%templatetag openvariable%}else error === 'uploadedBytes'{%templatetag closevariable%}Uploaded bytes exceed file size
                {%templatetag openvariable%}else error === 'emptyResult'{%templatetag closevariable%}Empty file upload result
                {%templatetag openvariable%}else{%templatetag closevariable%}${error}
                {%templatetag openvariable%}/if{%templatetag closevariable%}
            </td>
        {%templatetag openvariable%}else{%templatetag closevariable%}
            <td class="preview">
                {%templatetag openvariable%}if thumbnail_url{%templatetag closevariable%}
                    <a href="${url}" title="${name}" rel="gallery"><img src="${thumbnail_url}"></a>
                {%templatetag openvariable%}/if{%templatetag closevariable%}
            </td>
            <td class="name">
                <a href="${url}" title="${name}"{%templatetag openvariable%}if thumbnail_url{%templatetag closevariable%} rel="gallery"{%templatetag openvariable%}/if{%templatetag closevariable%}>${name}</a>
            </td>
            <td class="size">${sizef}</td>
            <td colspan="2"></td>
        {%templatetag openvariable%}/if{%templatetag closevariable%}
        <td class="delete">
            <button data-type="${delete_type}" data-url="${delete_url}">Delete</button>
            <input type="checkbox" name="delete" value="1">
        </td>
    </tr>
</script>

<script id="serviceformTemplate" type="text/x-jquery-tmpl">
    {% csrf_token %} 
    {{ serviceform.as_ul }}
</script>

<script id="usageHolderTemplate" type="text/x-jquery-tmpl">
    <div>
    <table style="width: 90%;table-layout: fixed">
        <tr>
            <td><div id="mservelast24" style="margin-top: 20px;"></div></td>
            <td><div id="mservelast1" style="margin-top: 20px;"></div></td>
        </tr>
    </table>

    <table style="width: 90%;table-layout: fixed">
        <tr>
            <td><div id="mservejobstype" style="margin-top: 20px;"></div></td>
            <td><div id="deliverySuccess" style="margin-top: 20px;"></div></td>
        </tr>
    </table>

    <div id="mservejobs" style="margin-top: 20px;"></div>
    <div class="clr"></div>

    <h3>Usage summary</h3>
    <div id="usagesummary" ></div>
</div>
</script>

<script id="tabsTemplate" type="text/x-jquery-tmpl">
    <div id="tabs-${tabid}" >
        <ul>
        {%templatetag openvariable%}each(index, tab) tabs{%templatetag closevariable%}
                <li><a href="#${tab.id}" rel="address:${tab.url}">${tab.name}</a></li>
        {%templatetag openvariable%}/each{%templatetag closevariable%}
        </ul>

        {%templatetag openvariable%}each(index, tab) tabs{%templatetag closevariable%}
                <div id="${tab.id}" class="ui-tabs-hide"></div>
        {%templatetag openvariable%}/each{%templatetag closevariable%}
    </div>
</script>

<script id="hostingcontainerformTemplate" type="text/x-jquery-tmpl">
        <div id="createcontainerholder" class="ui-corner-all" style="">
        <div class="ui-widget ui-widget-content ui-corner-all ui-accordion ui-widget ui-helper-reset ui-accordion-icons"
             style="margin: 1px;padding: 5px;width: 240px;border: 1px outset silver;">
            <h3 class="red ui-accordion-header ui-helper-reset ui-state-default ui-corner-all" style="font-size: 14px;padding: 4px;margin:3px;"
                role="tab" aria-expanded="false" tabindex="-1">New Container Form</h3>
            <form method="POST" id="createcontainerform" style="width: 100%">
                {% csrf_token %}
                {{ hostingcontainerform.as_ul }}
            </form>
            <button id="createcontainerbutton">Create</button>
        </div>
    </div>
</script>

<script id="mserveTemplate" type="text/x-jquery-tmpl">
<div>
    <div id="fileupload-accordion" class="single-accordion">
        <h3><a href="#">File Upload</a> </h3>
        <div id="fileupload" style="display: none">
            <form method="POST" enctype="multipart/form-data">
                <div class="fileupload-buttonbar">
                    <label class="fileinput-button">
                        <span>Add files...</span>
                        <input type="file" name="file" multiple>
                    </label>
                    <button type="submit" class="start">Start upload</button>
                    <button type="reset" class="cancel">Cancel upload</button>
                    <button type="button" class="delete">Delete selected</button>
                    <input type="checkbox" class="toggle" id="selectall"><label for="selectall">Select All</label>

                </div>
            </form>
            <div class="fileupload-content" style="height: 200px;overflow: scroll;overflow-x: hidden;">
            <div class="fileupload-progressbar"></div>
                <table class="files" border="0">

                </table>
            </div>
        </div>
    </div>
    <div id="import-accordion" class="single-accordion">
        <h3><a href="#">Remote Services</a> </h3>
        <div style="display: none">
        <div id="remote-services" style="height: 200px;overflow: scroll;overflow-x: hidden;">

        </div>
        </div>
    </div>
    <div class="ui-widget" style="margin-top: 10px">
        <div class="ui-widget-header ui-corner-top fileupload-buttonbar">
            <label class=" ui-button ui-widget ui-state-default ui-corner-all ui-button-text-icon-primary" >
                <span class="ui-button-icon-primary ui-icon ui-icon-folder-open"></span>
                <span class="ui-button-text">
                    <span>Folder Structure</span>
                </span>
            </label>
        </div>
        <table class="ui-widget-content" style="table-layout: fixed;width: 100%;" border="0">
            <tr>
                <td style="width: 15%">
                    
                    <div id="mfoldertreecontainer"></div></td>
                <td style="width: 65%">
                    <div id="mserve-folder-button-container" style="margin:10px">
                        <button id="mserve-new-folder-button" style="">New Folder</button>
                    </div>
                    <div class="nofiles" style="display: none">
                        {% templatetag openvariable %}tmpl( {"message":"No Files"} ) "#messageTemplate" {% templatetag closevariable %}
                    </div>

                    <ul id="qscontainer" ></ul>
                    <ul id="hiddenqscontainer" style="display: none"></ul>
                    <table id="mfilejobcontainer" style="width: 100%;display: none;" border="0" >
                        <tr>
                            <th width="180px" >New Job</th>
                            <th width="*" >Current Jobs</th>
                        </tr>
                        <tr>
                            <td width="180px"  id="mfilecreatejobcontainer" ></td>
                            <td width="*" id="mfilecurrentjobscontainer" ></td>
                        </tr>
                    </table>
                </td>
            </tr>

        </table>
    </div>
</div>
</script>

<script id="requestTemplate" type="text/x-jquery-tmpl">
    <div id="request-${id}" class="ui-widget" style="margin: 1px;">
        <div class="ui-state-highlight ui-corner-all" style="padding: 0 .4em;">
            <p>
                {%templatetag openvariable%}if state == "P" {%templatetag closevariable%}
                    <span class="ui-icon ui-icon-info" style="float: left; margin-right: .1em;"></span>
                {%templatetag openvariable%}/if{%templatetag closevariable%}

                {%templatetag openvariable%}if state == "A" {%templatetag closevariable%}
                    <span class="ui-icon ui-icon-circle-check" style="float: left; margin-right: .1em;"></span>
                {%templatetag openvariable%}/if{%templatetag closevariable%}

                {%templatetag openvariable%}if state == "R" {%templatetag closevariable%}
                    <span class="ui-icon ui-icon-alert" style="float: left; margin-right: .1em"></span>
                {%templatetag openvariable%}/if{%templatetag closevariable%}

                {%templatetag openvariable%}if isStaff {%templatetag closevariable%}
                <span><strong>Request From </strong><span class="red">${ profile.user.username }</span></span>&nbsp;:
                {%templatetag openvariable%}/if{%templatetag closevariable%}
               

                {%templatetag openvariable%}if state == "R" {%templatetag closevariable%}
                    <span style="font-weight: bold;color:red">${ status }</span>
                {%templatetag openvariable%}else{%templatetag closevariable%}
                    <span style="font-weight: bold">${ status }</span>
                {%templatetag openvariable%}/if{%templatetag closevariable%}

                {%templatetag openvariable%}if isStaff && state == "P" {%templatetag closevariable%}
                    <button style="" id="approve-button-${id}">Approve</button>
                    <button style="" id="reject-button-${id}">Reject</button>
                {%templatetag openvariable%}/if{%templatetag closevariable%}

                {%templatetag openvariable%}if !isStaff && state == "P" {%templatetag closevariable%}
                    <button style="float: right" id="delete-button-${id}">Delete</button>
                {%templatetag openvariable%}/if{%templatetag closevariable%}
                
            </p>
            <p>
                <span><strong>Requested Name : </strong>${ name }</span>
            </p>
            <p>
                <span><strong>Time : </strong>${ ctime }</span>
            </p>
            <p>
                <span><strong>Reason for request: </strong>${ reason }</span>
            </p>
        </div>
    </div>
</script>

<script id="strongMessageTemplate" type="text/x-jquery-tmpl">
    <div class="${cl} ui-widget" style="margin: 8px;display: inline-block;">
        <div class="ui-state-error ui-corner-all" style="padding: 0 .4em;">
            <p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span><strong>${ message }</strong></p>
        </div>
    </div>
</script>

<script id="messageTemplate" type="text/x-jquery-tmpl">
    <div class="${cl} ui-widget" style="margin: 8px;display: inline-block;">
        <div class="ui-state-highlight ui-corner-all" style="padding: 0 .4em;">
                <p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>${ message }</p>
        </div>
    </div>
</script>

<script id="containerTemplate" type="text/x-jquery-tmpl">
    <div id="container-${id}" class="ui-widget ui-widget-content ui-corner-all ui-accordion ui-widget ui-helper-reset ui-accordion-icons" style="margin: 5px;">
        <h3 class="red ui-accordion-header ui-helper-reset ui-state-default ui-corner-all" style="font-size: 14px" role="tab" aria-expanded="false" tabindex="-1">
            <span class="ui-icon ui-icon-triangle-1-e"></span><a>${name} ${created} <span style="float: right">${id}</span></a>
        </h3>

        <div class="ui-widget ui-corner-all" style="">
            <div class="ui-widget-content ui-state-highlight" style="padding:4px">
                {%templatetag openvariable%}if default_profile == null {%templatetag closevariable%}
                    <span>Services under this Container will use the <strong class="red">default</strong> profile.</span>
                {%templatetag openvariable%}else{%templatetag closevariable%}
                    <span>Services under this Container will use the <strong class="red">${default_profile}</strong> profile.</span>
                {%templatetag openvariable%}/if{%templatetag closevariable%}
                <span> Data will be stored in the <strong class="red">{{STORAGE_ROOT}}/${default_path}</strong> folder.</span>
            </div>
        </div>

        <div id="containermessages-${id}" class="" style="padding: 0 .4em;margin: 10px;">
            {%templatetag openvariable%}if dataservice_set.length==0 {%templatetag closevariable%}
                {% templatetag openvariable %}tmpl( {"cl":"container-message-"+id,"message":"No Services have been set up yet"} ) "#messageTemplate" {% templatetag closevariable %}
            {%templatetag openvariable%}/if{%templatetag closevariable%}
        </div>

        <table>
            <tr>
                <td>
                    <div id="containerserviceholder-${id}" style="padding: 0 .4em;margin: 10px;">
                        {%templatetag openvariable%}each(index, service) dataservice_set{%templatetag closevariable%}
                            {% templatetag openvariable %}tmpl(service ) "#serviceTemplate" {% templatetag closevariable %}
                        {%templatetag openvariable%}/each{%templatetag closevariable%}
                    </div>
                </td>
                <td>
                    <div id="createserviceholder-${id}" class="ui-corner-all " style="display: block">
                        <div class="ui-widget ui-widget-content ui-corner-all ui-accordion ui-widget ui-helper-reset ui-accordion-icons" style="margin: 10px;padding: 5px;width: 250px;float: right;border: 1px outset silver;">
                            <h3 class="red ui-accordion-header ui-helper-reset ui-state-default ui-corner-all" style="font-size: 14px;padding: 4px;margin:3px"
                                role="tab" aria-expanded="false" tabindex="-1">New Service Form</h3>
                            <form method="POST" id="createserviceform-${id}" style="width: 100%">
                                {% templatetag openvariable %}tmpl "#serviceformTemplate" {% templatetag closevariable %}
                            </form>
                            <button id="createservicebutton-${id}">Create</button>
                        </div>
                    </div>
                </td>
            </tr>
        </table>


        <div class="clr"></div>
    </div>
</script>

<script id="serviceTemplate" type="text/x-jquery-tmpl">

<div class="infoholder">
    <table cellpadding="0" cellspacing="0" style="margin-top:9px;margin-left: 12px;">

               {%templatetag openvariable%}each(i,val) [0,1,2,3]   {%templatetag closevariable%}

                 {%templatetag openvariable%}if i%4==0 {%templatetag closevariable%}
                 <tr>
                 {%templatetag openvariable%}/if{%templatetag closevariable%}

                 <td class="service_preview_td" style="background-image: url(${thumbs[i]});"></td>

                {%templatetag openvariable%}if i%4==1 {%templatetag closevariable%}
                 </tr>
                 {%templatetag openvariable%}/if{%templatetag closevariable%}

                {%templatetag openvariable%}/each{%templatetag closevariable%}
    </table>

    <div id="image-${id}" class='fluid'
                 {%templatetag openvariable%}if !mobile_browser {%templatetag closevariable%}
                    onmouseover="$('#id-${id}').show();"
                    onmouseout="$('#id-${id}').hide();"
                 {%templatetag openvariable%}/if{%templatetag closevariable%}
                    style="position: relative; top: -130px">

            <table cellpadding='0' cellspacing='0'  class='thumb' style="z-index: 2;" onclick="$.address.value('/services/${id}');"  >
                <colgroup><col>
                </colgroup>
                <tbody>
                <tr>
                    <td>
                        <div class='title'>{% autoescape off %}${getShort(name,20)}{% endautoescape  %}</div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class='info' style='background-image: url({{MEDIA_URL}}images/transparent-white.png); position:relative' id='id-${id}'>
                              <div>${mfile_set.length} files </div>
                              <div style="font-weight: bold">Latest Files :</div>

                              {%templatetag openvariable%}each mfile_set{%templatetag closevariable%}
                                    <!-- Show Last 4 files -->
                                  {%templatetag openvariable%}if $index < 4 {%templatetag closevariable%}
                                    <div>${getShort($value.name,30)}</div>
                                  {%templatetag openvariable%}/if{%templatetag closevariable%}
                              {%templatetag openvariable%}/each{%templatetag closevariable%}

                            <!--button id="newsubservicebutton-${id}" onclick="create_subservice('${id}','${containerid}')"  >New SubService</button-->

                          </div>
                    </td>
                </tr>
                </tbody>
            </table>
    </div>
</div>
</script>

<script id="serviceConfigTemplate" type="text/x-jquery-tmpl">
    <h2>Properties</h2>
           <table>
               <tr>
                   <td>
                          <dl style="padding-left: 40px;">
                            <dt>Created Time</dt>
                            <dd>${created}&nbsp;</dd>
                            <dt>Start Time</dt>
                            {%templatetag openvariable%}if starttime {%templatetag closevariable%}
                            <dd>${starttime}&nbsp;</dd>
                            {%templatetag openvariable%}else{%templatetag closevariable%}
                            <dd>No Start time&nbsp;</dd>
                            {%templatetag openvariable%}/if{%templatetag closevariable%}
                            <dt>End Time</dt>
                            {%templatetag openvariable%}if endtime {%templatetag closevariable%}
                            <dd>${endtime}&nbsp;</dd>
                            {%templatetag openvariable%}else{%templatetag closevariable%}
                            <dd>No End time&nbsp;</dd>
                            {%templatetag openvariable%}/if{%templatetag closevariable%}
                        </dl>
                   </td>
                   <td>
                       <div style="padding-left: 40px;">
                           <table><tr>
                                <td>
                                     <div style="padding: 10px;" id="prioritymessage"></div>
                              </td><td>
                                    <div style="padding: 10px;"></div>
                                        <button id="lowprioritybutton">Set to Low</button>
                                        <button id="highprioritybutton">Set to High</button>
                                    </div>
                              </td></tr>
                           </table>

                       </div>
                   </td>
                   <td>
                       <h3>Authority to Access this service</h3>
                        <dl style="padding-left: 40px;">
                            {%templatetag openvariable%}each auth_set{%templatetag closevariable%}
                            <dt>Auth ${$value.authname} (${$value.id})</dt>
                            <dd>Auth giving access to the roles (
                                {%templatetag openvariable%}each roles{%templatetag closevariable%}
                                    <strong>${$value}</strong>&nbsp;
                                {%templatetag openvariable%}/each{%templatetag closevariable%}
                                &nbsp;)
                                <a style="text-decoration: underline;" href="${$value.browse_url}">Browse this auth</a>
                            </dd>
                            {%templatetag openvariable%}/each{%templatetag closevariable%}
                        </dl>
                   </td>
               </tr>
           </table>


            <h2>Access </h2>
            <dl style="padding-left: 40px;">
                <dt>WebDAV</dt>
                <dd>
                        <strong><span id="webdav"></span></strong>
                </dd>
            </dl>

            <h2>Management Properties</h2>

            <table id="managementpropertyholder" style="width:100%;vertical-align: middle;padding:10px;padding-left: 40px;" >
                <tr>
                    <th style="width: 10%">Name</th>
                    <th style="width: 10%">Current Value</th>
                    <th style="width: 50%">New Value</th>
                    <th width="*" ></th>
                </tr>
            </table>

            <h4></h4>
                <table style="width:50%;vertical-align: middle;padding:10px;padding-left: 40px;" >
                    <tr><th style="width: 25%" colspan="2" >New Management Property</th></tr>
                    <form id="managementpropertyform">
                            {{ managementpropertyform.as_table }}
                    </form>
                    <tr><td></td><td><button id="managementpropertybutton">New Property</button></td></tr>
                </table>

            <h2>Profile Configuration</h2>

            <div id="profilepaginator">

            </div>
</script>

<script id="managementpropertyTemplate-string" type="text/x-jquery-tmpl">
    <tr>
        <th>${ property}</th>
        <td class="${ property } red" style="vertical-align: middle;">${ value }</td>
        
        <td >
            <input type="text" value="${ value }" name="val-${ id }" id="val-${ id }" style="border:1; color:#f6931f; font-weight:bold;"  />
        </td>
    </tr>
</script>

<script id="managementpropertyTemplate-choices" type="text/x-jquery-tmpl">
    <tr>
        <th>${ property}</th>
        <td class="${ property } red" style="vertical-align: middle;">${ value }</td>
        <td colspan="1" style="vertical-align: middle;">
            <div id="managementradio-${id}" class="servicetyperadio"></div>
        </td>
    </tr>
</script>


<script id="managementpropertyTemplate-steps" type="text/x-jquery-tmpl">
    <tr>
        <th>${ property}</th>
        <td class="${ property } red" style="text-align: center;vertical-align: middle;">${ value }</td>

        <td style="vertical-align: middle;"><div style="" id="slider-${ id }"></div></td>

        <td style="vertical-align: middle;text-align: center;">
            <input readonly type="text" id="val-${ id }" style="border:0; color:#f6931f; font-weight:bold;"  />
            <button id="service-setmanagementproperty-button-${ id }" >Set</button>
        </td>

    </tr>
</script>

<script id="serviceOAuthTemplate" type="text/x-jquery-tmpl">
    
<div class="infoholder">
    <table cellpadding="0" cellspacing="0" style="margin-top:9px;margin-left: 12px;">
        <tr>
             {%templatetag openvariable%}if mfile_set[0] {%templatetag closevariable%}
                          <td class="service_preview_td" style="background-image: url(${mfile_set[0].thumburl});"></td>
             {%templatetag openvariable%}else{%templatetag closevariable%}
                          <td class="service_preview_td" style="background-image: url('{{MEDIA_URL}}images/text-x-generic-template.png');"></td>
             {%templatetag openvariable%}/if{%templatetag closevariable%}

             {%templatetag openvariable%}if mfile_set[1] {%templatetag closevariable%}
                          <td class="service_preview_td" style="background-image: url(${mfile_set[1].thumburl});"></td>
              {%templatetag openvariable%}else{%templatetag closevariable%}
                          <td class="service_preview_td" style="background-image: url('{{MEDIA_URL}}images/text-x-generic-template.png');"></td>
             {%templatetag openvariable%}/if{%templatetag closevariable%}
        </tr>
        <tr>
             {%templatetag openvariable%}if mfile_set[2] {%templatetag closevariable%}
                          <td style="background-image: url(${mfile_set[2].thumburl});"></td>
             {%templatetag openvariable%}else{%templatetag closevariable%}
                          <td class="service_preview_td" style="background-image: url('{{MEDIA_URL}}images/text-x-generic-template.png');"></td>
             {%templatetag openvariable%}/if{%templatetag closevariable%}

             {%templatetag openvariable%}if mfile_set[3] {%templatetag closevariable%}
                           <td class="service_preview_td" style="background-image: url(${mfile_set[3].thumburl});"></td>
             {%templatetag openvariable%}else{%templatetag closevariable%}
                          <td class="service_preview_td" style="background-image: url('{{MEDIA_URL}}images/text-x-generic-template.png');"></td>
             {%templatetag openvariable%}/if{%templatetag closevariable%}
        </tr>
    </table>

    <div id="image-${id}" class='fluid'
                          {%templatetag openvariable%}if !mobile_browser {%templatetag closevariable%}
                    onmouseover="$('#id-${id}').show();"
                    onmouseout="$('#id-${id}').hide();"
                 {%templatetag openvariable%}/if{%templatetag closevariable%}
                 style="position: relative; top: -130px">

        <table cellpadding='0' cellspacing='0'  class='thumb' style="z-index: 2;">
            <colgroup><col>
            </colgroup>
            <tbody>
            <tr><td>
                    <div class='title'>
                                {% autoescape off %}
                                    ${getShort(name,20)}
                                {% endautoescape  %}
                    </div></td></tr>
            <tr><td>
                    <div class='info' style='background-image: url({{MEDIA_URL}}images/transparent-white.png); position:relative' id='id-${id}'>
                          <div>${mfile_set.length} files </div>
                          <div style="font-weight: bold">Latest Files :</div>

                          {%templatetag openvariable%}each mfile_set{%templatetag closevariable%}
                                <!-- Show Last 4 files -->
                              {%templatetag openvariable%}if $index < 4 {%templatetag closevariable%}
                                <div>${getShort($value.name,30)}</div>
                              {%templatetag openvariable%}/if{%templatetag closevariable%}
                          {%templatetag openvariable%}/each{%templatetag closevariable%}
                      </div>
                </td></tr>
            </tbody>
        </table>
        <form>
        <input type="checkbox" id="${id}" /><label for="${id}">Select</label>
        </form>
    </div>
</div>
</script>

<script id="profileTabsTemplate" type="text/x-jquery-tmpl">
    <div id="profiletabs">
	<ul>
            {%templatetag openvariable%}each(index,profile) profiles{%templatetag closevariable%}
		<li><a href="#profiletab-${profile.id}">${profile.name}</a></li>
             {%templatetag openvariable%}/each{%templatetag closevariable%}
	</ul>
    </div>
</script>

<script id="profileTemplate" type="text/x-jquery-tmpl">
    <div id="profiletab-${id}">
        <p>This profile has <span class="red">${workflows.length}</span> workflows. Click on a workflow name to view.</p>
        <div class="workflow-accordian">
        {%templatetag openvariable%}each(index,workflow) workflows{%templatetag closevariable%}
                <h3 class="red" style="font-size: 14px"><a href="#">Workflow ${workflow.name} <span style="float: right">ID: ${workflow.id}</span></a></h3>
                <div>
                    
                    {%templatetag openvariable%}if workflow.tasksets.length == 0 {%templatetag closevariable%}
                        <!--span class="red">No TaskSets</span-->
                    {%templatetag openvariable%}/if{%templatetag closevariable%}

                    <div id="workflowbody-${workflow.id}">
                        {% templatetag openvariable %}tmpl(workflow.tasksets,  { "workflowid" : workflow.id, } ) "#taskSetTemplate" {% templatetag closevariable %}
                    </div>

                     <div class="ui-widget" id="workflowsavedmsg-${workflow.id}" style="display: none">
                            <div class="ui-state-error ui-corner-all" style="padding: 0 .7em;">
                                    <p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span>
                                    <strong>Alert:</strong> Order has changed - Remember to Save.</p>
                            </div>
                    </div>

                    <div class="ui-widget ui-widget-content ui-corner-all " style="margin: 5px;margin-bottom:15px">
                        <table>
                            <tr>
                                <td style="vertical-align: middle"><span class="red bold smallcaps">Add New Task Set</span></td>
                                <td>
                                    <form id="newtasksetform-workflow-${workflow.id}">
                                        <input type="hidden" style="width: 96%" id="id_workflow" name="workflow" value="${workflow.id}" >
                                        <input type="hidden" style="width: 96%" id="id_order" name="order" value="-1" >
                                        <input type="text" style="width: 96%" value="New Task Set" name="name" id="id_name" class="name" >
                                    </form>
                                </td>
                                <td>
                                    <button id="addbutton-taskset-${id}">Add Task Set</button>
                                    <button id="workflowbody-savebutton-${id}">Save Order</button>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
        {%templatetag openvariable%}/each{%templatetag closevariable%}
        </div>
    </div>
</script>

<script id="taskSetTemplate" type="text/x-jquery-tmpl">
    <div class="taskset ui-widget ui-widget-content ui-corner-all" style="margin: 5px" id="taskset-${id}" data-taskid="${id}">
        <div class="ui-widget ui-state-default">
                <div style="margin: 10px;font-weight: bold;font-size: 12px">
                    ${name}<span style="float: right">Order: ${order} ID: ${id}</span>
                </div>
        </div>

        <form id="tasksetupdateform-taskset-${id}" class="tasksetupdateform-taskset" >
            <input type="hidden" style="width: 96%" id="id_name" name="name" value="${name}" >
            <input type="hidden" style="width: 96%" id="id_workflow" name="workflow" value="${$item.workflowid}" >
            <input type="hidden" style="width: 96%" id="id_taskset" name="taskset" value="${id}" >
            <input type="hidden" style="width: 96%" id="id_order" name="order" value="" >
        </form>

        <button style="clear:both;margin:5px" id="deletetasksetbutton-${id}">Delete Task Set</button>
        <div class="ui-widget " style="margin: 5px 15px 15px 15px">
            <table id="tasksettable-${id}" border="0" style="1px outset silver;" >
                <tr><th style="width: 5%">Task ID</th><th style="width: 16%">Task Name</th><th style="width: 16%">Task</th><th style="width: 20%">Condition</th><th style="width: 20%">Arguments</th>

                    {%templatetag openvariable%}if tasks.length == 0 {%templatetag closevariable%}
                    <!--tr>
                        <td class="red">No Tasks</td>
                    </tr-->
                    {%templatetag openvariable%}/if{%templatetag closevariable%}

                    <tbody style="border: 1px solid red;" >
                        {% templatetag openvariable %}tmpl(tasks, { "tasksetid" : id, } ) "#taskTemplate" {% templatetag closevariable %}
                    </tbody>
                    
                    <tbody style="border: 1px solid red;margin-top: 10px;" id="tasksetbody-${id}" >
                    </tbody>
                    
                    <tbody style="border: 1px solid red;margin-top: 10px;" >
                    <tr>
                        <form id="newtaskform-taskset-${id}">
                            <td style="vertical-align: middle"><span class="red bold smallcaps">New</span></td>
                        <td>
                            <input type="hidden" style="width: 96%" id="id_workflow" name="workflow" value="${workflowid}" >
                            <input type="hidden" style="width: 96%" id="id_taskset" name="taskset" value="${id}" >
                            <input type="text" style="width: 96%" value="New Task" name="name" id="id_name" class="name" >
                        </td>
                        <td>
                            <input type="text" style="width: 96%" value="md5file" name="task_name" id="id_task_name" class="task_name" >
                        </td>
                        <td>
                            <input type="text" style="width: 96%" value="" id="id_condition" name="condition" >
                        </td>
                        <td>
                            <textarea style="width: 96%;border: 1px dotted silver" NAME="args" COLS=30 ROWS=1" name="args">{}</textarea>
                        </td>
                        </form>
                        <td>
                            <button id="addbutton-task-${id}">Add Task</button>
                        </td>
                    </tr>
                    </tbody>
            </table>

        </div>
    </div>

</script>

<script id="taskTemplate" type="text/x-jquery-tmpl">
    <tr  id="task-${id}">
        <td>${id}</td>
        <form id="taskform-task-${id}" >
            
        <td class="green">
            <input type="hidden" style="width: 96%" id="id_taskset" name="taskset" value="${$item.tasksetid}" >
            <input type="text" style="width: 96%" name="name" id="id_name" class="name" value="${name}" >
        </td>
        <td class="green"><input type="text" style="width: 96%" name="task_name" id="id_task_name" class="task_name" value="${task_name}" ></td>
        <td>
            <input type="text" style="width: 96%" value="${condition}" id="id_condition" name="condition" >
        </td>
        <td>
            <textarea style="width: 96%;border: 1px dotted silver" NAME="args" COLS=30 ROWS=1 id="id_args-${id}">${args}</textarea>
        </td>
        </form>
        <td>
            <button id="edittaskbutton-${id}" class="savebutton">Save</button>
            <button id="deletetaskbutton-${id}" class="delbutton">Delete</button>
        </td>
    <tr>
</script>

<script id="authTemplate" type="text/x-jquery-tmpl">

<div class="infoholder" id="mfileholder-${id}" >
    <div id="image-${id}" class='fluid'
                {%templatetag openvariable%}if !mobile_browser {%templatetag closevariable%}
                    onmouseover="$('#id-${id}').show();"
                    onmouseout="$('#id-${id}').hide();"
                 {%templatetag openvariable%}/if{%templatetag closevariable%}
                >
        <a href='/browse/${id}/'>
            <table id="mfile-table-${id}" cellpadding='0' cellspacing='0' style='background-image:url("${thumburl}");' class='thumb'>
            <tbody>
            <tr>
                <td>
                    <div class='title'>
                        {% autoescape off %}
                                    ${getShort(authname+" access to "+ basename,20)}
                        {% endautoescape  %}
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class='info' style='background-image: url({{MEDIA_URL}}images/transparent-white.png); position:relative' id='id-${id}'>
                        ${authname} access to ${basename}
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
        </a>
    </div>

</div>

</script>


<script id="mfileDetailsTemplate" type="text/x-jquery-tmpl">
    <h3>Details</h3>
    <div id="message"></div>
    <table><tr><td>
        <dl>
            <dt>Name</dt>
            <dd>${name}</dd>
            <dt>Checksum</dt>
            <dd>${checksum}</dd>
            <dt>Mime</dt>
            <dd>${mimetype}</dd>
        </dl>
     </td><td>
        <dl>
            <dt>Created</dt>
            <dd>${created}</dd>
            <dt>Updated</dt>
            <dd>${updated}</dd>
            <dt>Size</dt>
            <dd>${size}</dd>
        </dl>
     </td></tr>
    </table>
    
</script>

<script id="mfileImageDetailsTemplate" type="text/x-jquery-tmpl">
        {% templatetag openvariable %}tmpl "#mfileDetailsTemplate" {% templatetag closevariable %}
        <div class="posterholder" style="display: none">
            <div class="poster" id="image-preview" style=" height: 256px; padding: 0.4em; position: relative;" >
                <img id="mfileposter" title="${name}" alt="${name}" src="${posterurl}" />
            </div>
        </div>
</script>

<script id="mfileUploadFailedTemplate" type="text/x-jquery-tmpl">
    <div class="mfileUpload">
        <table>
            <tr>
                <td rowspan="2" class="file_upload_preview"></td>
                <td colspan="1" class="ui-state-error-text">${error}</td>
                <td class="file_upload_cancel">
                <button class="ui-state-default ui-corner-all" title="Cancel">
                    <span class="ui-icon ui-icon-cancel">Cancel</span>
                </button>
                </td>
            </tr>
            <tr>
                <td colspan="2" class="file_upload_progress"><div></div></td>
            </tr>
        </table>
    </div>
</script>

<script id="mfileUploadTemplate" type="text/x-jquery-tmpl">
    <div class="mfileUpload">
        <table>
            <tr>
                <td rowspan="2" class="file_upload_preview"></td>
                <td colspan="1">${getShort(name,20)}</td>
                <td class="file_upload_cancel">
                    <button class="ui-state-default ui-corner-all" title="Cancel">
                <span class="ui-icon ui-icon-cancel">Cancel</span>
                </button>
                </td>
            </tr>
            <tr>
                <td colspan="2" class="file_upload_progress"><div></div></td>
            </tr>
        </table>
    </div>
</script>

<script id="mfileUploadCompleteTemplate" type="text/x-jquery-tmpl">

</script>

<script id="mfileVideoDetailsTemplate" type="text/x-jquery-tmpl">
        {% templatetag openvariable %}tmpl "#mfileDetailsTemplate" {% templatetag closevariable %}
        <p id="container1">Please install the Flash Plugin</p>
</script>

<script id="mfileRenderDetailsTemplate" type="text/x-jquery-tmpl">
        {% templatetag openvariable %}tmpl "#mfileDetailsTemplate" {% templatetag closevariable %}
</script>

<script id="usageTemplate" type="text/x-jquery-tmpl">

    {%templatetag openvariable%}if rate == 0 {%templatetag closevariable%}
        <tr><td>Usage of <a href='/browse/${id}'>${name}</a>&nbsp;</td><td><b>${metric}</b></td><td>at <b>${rateTime}</b> was<td><b>${total}</b></td></tr>
    {%templatetag openvariable%}else{%templatetag closevariable%}

        <tr><td>Usage of <a href='/browse/${id}'>${base}</a>&nbsp;</td><td><b>${metric}</b></td><td>at <b>${rateTime}</b> was<td><b>${rate} per second</b></td></tr>
    {%templatetag openvariable%}/if{%templatetag closevariable%}

</script>

<script id="usageSummaryTableTemplate" type="text/x-jquery-tmpl">
    <table class="table_usage" cellpadding="5" cellspacing="5">
        <tr><th style="text-align: left">Metric Name</th><th>Min</th><th>Max</th><th>Count</th><th>Average</th><th>Sum</th><th>Std. Dev</th><th style="display: none" class="var">Variance</th></tr>
        <tbody id="${usageholderid}"></tbody>
    </table>
    <button class="togglevarbutton" onclick="$('.var').toggle()" >Show/Hide Variance</button>
</script>

<script id="usageSummaryTemplate" type="text/x-jquery-tmpl">

    {%templatetag openvariable%}if n==0{%templatetag closevariable%}
        <tr>
            <td style="text-align: left;"><b>${metric}</b></td>
            <td align="right">-</td>
            <td align="right">-</td>
            <td align="right">0</td>
            <td align="right">-</td>
            <td align="right">-</td>
            <td align="right">-</td>
            <td style="display: none" class="var" align="right">-</td>
        </tr>
    {%templatetag openvariable%}else{%templatetag closevariable%}
        <tr>
                <td style="text-align: left;"><b>${metric}</b></td>
                <td class="green" align="right" title="${min}">${scaleNumber(min, 0, '.', ',')}</td>
                <td class="red"   align="right" title="${max}">${scaleNumber(max, 0, '.', ',')}</td>
                <td               align="right" title="${n}">${scaleNumber(n, 0, '.', ',')}</td>
                <td class="dblue" align="right" title="${avg}">${scaleNumber(avg, 2, '.', ',')}</td>
                <td               align="right" title="${sum}">${scaleNumber(sum, 2, '.', ',')}</td>
                <td               align="right" title="${stddev}">${scaleNumber(stddev, 2, '.', ',')}</td>
                <td style="display: none" class="var" align="right" title="${variance}">${scaleNumber(variance, 2, '.', ',')}</td>
        </tr>
    {%templatetag openvariable%}/if{%templatetag closevariable%}

</script>

<script id="graphLabelTemplate" type="text/x-jquery-tmpl">
    <div>
    <div class="graphlabel ui-widget-content ui-corner-all" >
        ${label}<br/>
        ${Math.round( series.percent) }% (${series.data[0][1]})
    </div>
    </div>
</script>

<script id="large_graphTemplate" type="text/x-jquery-tmpl">
    <table title="Chart for ${label}" class="graphtable graphtable-${type} graphtable-${size}">
        <tr><th>${getShort(label,20)}</th></tr>
        <tr><td><div class='graph' style="width:95%;height:300px;"></div></td></tr>
    </table>
</script>

<script id="small_graphTemplate" type="text/x-jquery-tmpl">
    <table title="Chart for ${label}" class="graphtable graphtable-${type} graphtable-${size} graphtable-${type}-${size}">
        <tr><th>${getShort(label,20)}</th></tr>
        <tr><td><div class='graph' style="width:95%;height:150px;"></div></td></tr>
    </table>
</script>

<script id="graphTemplate" type="text/x-jquery-tmpl">
    <table title="Chart for ${label}" class="graphtable graphtable-${type} graphtable-${size}">
        <tr><th>${getShort(label,20)}</th></tr>
        <tr><td><div class='graph' style="width:95%;height:250px;"></div></td></tr>
    </table>
</script>

<script id="jobResultTemplate" type="text/x-jquery-tmpl">
    <div>RESULT {% templatetag openvariable %} ${JSON.stringify(${})} {% templatetag closevariable %}</div>
</script>

<script id="jobTemplate" type="text/x-jquery-tmpl">
    <h5 id='jobheader-${id}' title="${name}, ${created}, ${id}" >${name}, ${created}, <em></em></h5>
    
    <div id='job-${id}' class='job'  >
        <table style='width:100%;'>
        <tr VALIGN=MIDDLE>
            {%templatetag openvariable%}if tasks.successful {%templatetag closevariable%}
                <td width="2%"><span id='jobicon-${id}' class='ui-icon ui-icon-circle-check' ></span></td>
            {%templatetag openvariable%}else{%templatetag closevariable%}
                <td width="2%"><span id='jobicon-${id}' class='ui-icon ui-icon-circle-close' ></span></td>
            {%templatetag openvariable%}/if{%templatetag closevariable%}
            <td width="25%"><div id='jobinfo-${id}' class='jobinfo' ><b>${tasks.completed_count}</b> task of <b>${tasks.total}</b> complete : ${tasks.percent}&#37; </div></td>
            <th width='20%' ><div style='height:10px;' id='jobprogressbar-${id}'></div></th>
            <td width='5%' ><button id='jobdeletebutton-${id}'></button></td>
            <th width="8%"><div id='jobinfo-${id}' class='jobinfo' >${joboutput_set.length} output(s)</div></th>
        <tr>
        </table>
        <div  id='joboutputs-${id}' ></div>
        <div  id='jobpreviewpaginatorheader-${id}' class="jobpaginators" ></div>
        <table id='jobpreviewpaginator-${id}' class="jobpaginators" ></table>
    </div>
</script>

<script id="jobTaskResultTemplate" type="text/x-jquery-tmpl">
    {%templatetag openvariable%}if success {%templatetag closevariable%}
        <div class="taskholder"><b>Task :</b>
            <span style='color:green' >Name</span> - <span style='color:blue' >${name}</span>
            <span style='color:green' >Message</span> - <span style='color:blue' >
                    {%templatetag openvariable%}if result {%templatetag closevariable%}
                        <span>${result.message}</span>
                    {%templatetag openvariable%}/if{%templatetag closevariable%}
            </span>
            <div style="padding-left: 20px;"><b>Result :</b><span style="font-family: Courier">${JSON.stringify($item["data"]["result"],replacer)}</span></div>
        </div>
    {%templatetag openvariable%}else{%templatetag closevariable%}
    <div class="taskholder">
        <b>Task :</b>
            <span style='color:green' >Name</span> - <span style='color:red' >${name}</span>
            {%templatetag openvariable%}if state{%templatetag closevariable%}
                {%templatetag openvariable%}if state == "PENDING" {%templatetag closevariable%}
                    <span class="spinner"></span>
                {%templatetag openvariable%}/if{%templatetag closevariable%}
            {%templatetag openvariable%}/if{%templatetag closevariable%}
            {%templatetag openvariable%}if result {%templatetag closevariable%}
                <div style="padding-left: 20px;"><b>Result :</b><span style="font-family: Courier">${JSON.stringify($item["data"]["result"],replacer)}</span></div>
            {%templatetag openvariable%}/if{%templatetag closevariable%}
        </div>
    {%templatetag openvariable%}/if  {%templatetag closevariable%}
</script>


<script id="mfolderOAuthTemplate" type="text/x-jquery-tmpl">
<div class="infoholder">
    <div id="image-${id}" class='fluid'
                 {%templatetag openvariable%}if !mobile_browser {%templatetag closevariable%}
                    onmouseover="$('#id-${id}').show();"
                    onmouseout="$('#id-${id}').hide();"
                 {%templatetag openvariable%}/if{%templatetag closevariable%}
                 >
            <table cellpadding='0' cellspacing='0' style='background-image:url("");' class='thumb'>
            <colgroup><col>
            </colgroup>
            <tbody>
            <tr><td>
                    <div class='title'>
                                {% autoescape off %}
                                    ${getShort(name,20)}
                                {% endautoescape  %}
                       </div></td></tr>
            <tr><td>

                    <div class='info' style='background-image: url({{MEDIA_URL}}images/transparent-white.png); position:relative' id='id-${id}'>

                    </div>

              </td></tr>
            <tr><td></td></tr>
            </tbody>
        </table>
        <form action="POST" target="/auth/">
        <input type="checkbox" id="${id}" /><label for="${id}">Select</label>
        </form>
    </div>
</div>
</script>

<script id="mfileOAuthTemplate" type="text/x-jquery-tmpl">
<div class="infoholder">
    <div id="image-${id}" class='fluid'
                 {%templatetag openvariable%}if !mobile_browser {%templatetag closevariable%}
                    onmouseover="$('#id-${id}').show();"
                    onmouseout="$('#id-${id}').hide();"
                 {%templatetag openvariable%}/if{%templatetag closevariable%}
                 >
            <table id="mfile-table-${id}" cellpadding='0' cellspacing='0' style='background-image:url("${thumburl}");' class='thumb'>
            <colgroup><col>
            </colgroup>
            <tbody>
            <tr><td>
                    <div class='title'>
                                {% autoescape off %}
                                    ${getShort(name,20)}
                                {% endautoescape  %}
                       </div></td></tr>
            <tr><td>

                    <div class='info' style='background-image: url({{MEDIA_URL}}images/transparent-white.png); position:relative' id='id-${id}'>
                      <div>Size: ${size}</div>
                      <div style='font-size: x-small;'>Type</div>
                      <div style='font-size: xx-small;text-align: center'>${mimetype}</div>
                      <div style='font-size: x-small;'>Created: ${created}</div>
                      <div style='font-size: x-small;'>Updated: ${updated}</div>
                      <div style='font-size: xx-small;'>Checksum:</div>
                      <div style='font-size: xx-small;text-align: center;'>${checksum}</div>
                    </div>

              </td></tr>
            <tr><td></td></tr>
            </tbody>
        </table>
        <form>
            <input type="checkbox" id="${id}" /><label for="${id}">Select</label>
        </form>

    </div>
</div>
</script>

<script id="mfolderTemplate" type="text/x-jquery-tmpl">

 {%templatetag openvariable%}if parent {%templatetag closevariable%}
    <li class="infoholder ${parent.id}" data-id="mfolderholder-${id}" id="mfolderholder-${id}"  style="display: inline">
 {%templatetag openvariable%}else{%templatetag closevariable%}
    <li class="infoholder rootfolder" data-id="mfolderholder-${id}" id="mfolderholder-${id}" style="display: inline">
 {%templatetag openvariable%}/if{%templatetag closevariable%}

    <div id="image-${id}" class='fluid' onclick='$("#mserve").mserve("selectNode","${id}" )'
                  {%templatetag openvariable%}if !mobile_browser {%templatetag closevariable%}
                    onmouseover="$('#id-${id}').show();"
                    onmouseout="$('#id-${id}').hide();"
                 {%templatetag openvariable%}/if{%templatetag closevariable%}
            >
            <table id="mfile-table-${id}" cellpadding='0' cellspacing='0'  class='thumb' style="background-image: url({{MEDIA_URL}}images/icon_generic_120x120.png)">
            <colgroup><col>
            </colgroup>
            <tbody>
            <tr>
                <td>
                    <div class='title'>
                                {% autoescape off %}
                                    ${getShort(name,20)}
                                {% endautoescape  %}
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class='info' style='background-image: url({{MEDIA_URL}}images/transparent-white.png); position:relative' id='id-${id}'>

                         {%templatetag openvariable%}if parent {%templatetag closevariable%}
                            <button id="deletemfolderbutton-${id}" onclick='$("#mserve").mserve("deleteMFolder","${id}","${url}","${parent.id}")' >Delete</button>
                         {%templatetag openvariable%}else{%templatetag closevariable%}
                            <button id="deletemfolderbutton-${id}" onclick='$("#mserve").mserve("deleteMFolder","${id}","${url}")' >Delete</button>
                         {%templatetag openvariable%}/if{%templatetag closevariable%}


                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</li>
</script>

<script id="mfilePosterTemplate" type="text/x-jquery-tmpl">
    <div class="${id}" data-id="mfileposterholder-${id}" id="mfileposterholder-${id}" style="display: inline-block;width: 100%" >
        <table border="0" >
        <tr>
            <td width="40%">
                <table border="0" style="">
                <tr>
                    <td>
                        <h3>${name}</h3>
                        <dl>
                            <dt>ID</dt>
                            <dd>${id}</dd>
                            <dt>Checksum</dt>
                            <dd>${checksum}</dd>
                            <dt>Mime</dt>
                            <dd>${mimetype}</dd>
                            <dt>Created</dt>
                            <dd>${Date(created)}</dd>
                            <dt>Updated</dt>
                            <dd>${Date(updated)}</dd>
                            <dt>Size</dt>
                            <dd>${formatSize(size)}</dd>
                    </dl>
                 </td>
                </tr>
            </table>
        </td>
         {%templatetag openvariable%}if mimetype.startsWith("video") {%templatetag closevariable%}
         <td width="600px">
                <h5>Video Proxy</h5>
                {%templatetag openvariable%}if proxyurl {%templatetag closevariable%}
                <iframe
                  scrolling="no"
                  width="100%"
                  height="280"
                  id="video_iframe"
                  marginheight="0"
                  frameborder="0"
                  src="/videoplayer/${id}/"  >
                </iframe>
                {%templatetag openvariable%}else{%templatetag closevariable%}
                    {% templatetag openvariable %}tmpl( {"message":"Video file has no proxy"} ) "#messageTemplate" {% templatetag closevariable %}
                {%templatetag openvariable%}/if{%templatetag closevariable%}
            </td>
         {%templatetag openvariable%}else{%templatetag closevariable%}
            {%templatetag openvariable%}if mimetype.startsWith("image") {%templatetag closevariable%}
                <td width="50%">
                    <h5>Image Poster</h5>
                    <div class="posterholder">
                        <div class="poster" id="image-${id}" style=" height: 256px; width: 420px; padding: 0.4em; position: relative;
                            background-image: url(${posterurl});
                            background-position:center;" >
                        </div>
                    </div>
                </td>
            {%templatetag openvariable%}/if{%templatetag closevariable%}
         {%templatetag openvariable%}else{%templatetag closevariable%}
            {% templatetag openvariable %}tmpl( {"message":"No Preview"} ) "#messageTemplate" {% templatetag closevariable %}
         {%templatetag openvariable%}/if{%templatetag closevariable%}
        </tr>
        <tr>
            <td colspan="2"><h3>Actions</h3>
                <button class="mfile_rename_button-${id}" >Rename</button>
                <button class="mfile_download_button-${id}" onclick='window.open("${download_url}")' >Download</button>
                <button class="mfile_delete_button-${id}" >Delete</button>
                <button class="mfile_relationship_button-${id}" >Create Relationship</button>
            </td>
        </tr>
        <tr><td><h3>Related Files</h3><small><img height="20" width="20" src="{{MEDIA_URL}}images/star-file.png" />&nbsp;Indicates current file</small></td></tr>
        <tr>
            {%templatetag openvariable%}if relations.length!=0 {%templatetag closevariable%}
                <td colspan="2" style="width: 400px; border: 0px solid red;" >
                    <table border="0" style="overflow: scroll;border: 0px solid green">
                    {%templatetag openvariable%}each(index, relation) relations{%templatetag closevariable%}
                        <tr>
                            <td>
                               {% templatetag openvariable %}tmpl( relation.left,  { "currentid" : id, } ) "#mfileClickableTemplate" {% templatetag closevariable %}
                            </td>
                            <td style="padding-top: 20px;text-align: center">
                                <div><strong>${name}</strong></div>
                                <img title="relates" alt="relates" src="{{MEDIA_URL}}images/go-next.png" />
                            </td>
                            <td>
                               {% templatetag openvariable %}tmpl( relation.right,  { "currentid" : id, } ) "#mfileClickableTemplate" {% templatetag closevariable %}
                            </td>
                        </tr>
                    {%templatetag openvariable%}/each{%templatetag closevariable%}
                    </table>
                </td>
            {%templatetag openvariable%}else{%templatetag closevariable%}
                <td><em>No related files</em></td>
            {%templatetag openvariable%}/if{%templatetag closevariable%}
        </tr>
        </table>
    </div>
</script>

<script id="mfileTemplate" type="text/x-jquery-tmpl">
    
 {%templatetag openvariable%}if folder {%templatetag closevariable%}
    <li class="infoholder ${folder.id} ${id}" data-id="mfileholder-${id}"  id="mfileholder-${id}" style="display: inline"  >
 {%templatetag openvariable%}else{%templatetag closevariable%}
    <li class="infoholder rootfolder ${id}" data-id="mfileholder-${id}" id="mfileholder-${id}" style="display: inline" >
 {%templatetag openvariable%}/if{%templatetag closevariable%}

    <div id="image-${id}" class='fluid'  onclick='$("#mserve").mserve("selectNode","${id}" )'
                  {%templatetag openvariable%}if !mobile_browser {%templatetag closevariable%}
                    onmouseover="$('#id-${id}').show();"
                    onmouseout="$('#id-${id}').hide();"
                 {%templatetag openvariable%}/if{%templatetag closevariable%}
            >
            
            <table id="mfile-table-${id}" cellpadding='0' cellspacing='0' style='background-image:url("${thumburl}");' class='thumb'>
            <colgroup><col>
            </colgroup>
            <tbody>
            <tr>
                <td>
                    <div class='title'>{% autoescape off %}${getShort(name,20)}{% endautoescape  %}</div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class='info' style='background-image: url({{MEDIA_URL}}images/transparent-white.png); position:relative' id='id-${id}'>
                          <div>Size: ${size}</div>
                          <div style='font-size: x-small;'>Type</div>
                          <div style='font-size: xx-small;text-align: center'>${mimetype}</div>
                          <div style='font-size: x-small;'>Created: ${created}</div>
                          <div style='font-size: x-small;'>Updated: ${updated}</div>
                          <div style='font-size: xx-small;'>Checksum:</div>
                          <div style='font-size: xx-small;text-align: center;'>${checksum}</div>
                        
                        <button id="deletemfilebutton-${id}" onclick='$("#mserve").mserve("deletemfile","${id}")' >Delete</button>
                      </div>
                </td>
            </tr>
            </tbody>
        </table>
    
    </div>

    {%templatetag openvariable%}if mimetype{%templatetag closevariable%}
        {%templatetag openvariable%}if mimetype.startsWith("video") || name.endsWith("mxf")  {%templatetag closevariable%}
        <div style="height: 50px;width: 50px;position: relative;left:195px;top:0px;background-image: url('{{MEDIA_URL}}images/icon_video.png') ;background-repeat: no-repeat;" ></div>
        {%templatetag openvariable%}else mimetype.startsWith("text") {%templatetag closevariable%}
        <div style="height: 50px;width: 50px;position: relative;left:195px;top:0px;background-image: url('{{MEDIA_URL}}images/icon_text.png') ;background-repeat: no-repeat;" ></div>
        {%templatetag openvariable%}else mimetype.startsWith("image") {%templatetag closevariable%}
        <div style="height: 50px;width: 50px;position: relative;left:195px;top:0px;background-image: url('{{MEDIA_URL}}images/icon_image.png') ;background-repeat: no-repeat;" ></div>
         {%templatetag openvariable%}else{%templatetag closevariable%}
        <div style="height: 50px;width: 50px;position: relative;left:195px;top:0px;background-image: url('{{MEDIA_URL}}images/icon_generic.png') ;background-repeat: no-repeat;" ></div>
        {%templatetag openvariable%}/if{%templatetag closevariable%}
    {%templatetag openvariable%}/if{%templatetag closevariable%}
</li>
</script>


<script id="mfileClickableTemplate" type="text/x-jquery-tmpl">
<div class="infoholder" onclick='$("#mserve").mserve("showMFile","${id}" )'>
    <div id="image-${id}" class='fluid' >
            <table id="mfile-table-${id}" cellpadding='0' cellspacing='0' style='background-image:url("${thumburl}");' class='thumb'>
            <colgroup><col>
            </colgroup>
            <tbody>
            <tr><td>
                    <div class='title'>
                                {% autoescape off %}
                                    ${getShort(name,20)}
                                {% endautoescape  %}
                        </div></td></tr>
            <tr><td>
                    <div style=';background-image: url({{MEDIA_URL}}images/transparent-white.png); position:relative' >
                          <div>Size: ${size}</div>
                          <div style='font-size: x-small;'>Type</div>
                          <div style='font-size: xx-small;text-align: center'>${mimetype}</div>
                          <div style='font-size: x-small;'>Created: ${created}</div>
                          <div style='font-size: x-small;'>Updated: ${updated}</div>
                          <div style='font-size: xx-small;'>Checksum:</div>
                          <div style='font-size: xx-small;text-align: center;'>${checksum}</div>
                      </div>
                </td></tr>
            </tbody>
        </table>
    </div>

    {%templatetag openvariable%}if mimetype{%templatetag closevariable%}
        {%templatetag openvariable%}if mimetype.startsWith("video") || name.endsWith("mxf")  {%templatetag closevariable%}
        <div style="height: 50px;width: 50px;position: relative;left:195px;top:0px;background-image: url('{{MEDIA_URL}}images/icon_video.png') ;background-repeat: no-repeat;" ></div>
        {%templatetag openvariable%}else mimetype.startsWith("text") {%templatetag closevariable%}
        <div style="height: 50px;width: 50px;position: relative;left:195px;top:0px;background-image: url('{{MEDIA_URL}}images/icon_text.png') ;background-repeat: no-repeat;" ></div>
        {%templatetag openvariable%}else mimetype.startsWith("image") {%templatetag closevariable%}
        <div style="height: 50px;width: 50px;position: relative;left:195px;top:0px;background-image: url('{{MEDIA_URL}}images/icon_image.png') ;background-repeat: no-repeat;" ></div>
         {%templatetag openvariable%}else{%templatetag closevariable%}
        <div style="height: 50px;width: 50px;position: relative;left:195px;top:0px;background-image: url('{{MEDIA_URL}}images/icon_generic.png') ;background-repeat: no-repeat;" ></div>
        {%templatetag openvariable%}/if{%templatetag closevariable%}
    {%templatetag openvariable%}/if{%templatetag closevariable%}

     {%templatetag openvariable%}if id == $item.currentid{%templatetag closevariable%}
        <img src="{{MEDIA_URL}}images/star-file.png" style="height: 40px;width: 40px;position: relative;left:195px;top:-20x;" />
     {%templatetag openvariable%}/if{%templatetag closevariable%}

</div>
</script>

<script id="mfileNoActionTemplate" type="text/x-jquery-tmpl">
<div class="infoholder">
    <div id="image-${id}" class='fluid' >
            <table id="mfile-table-${id}" cellpadding='0' cellspacing='0' style='background-image:url("${thumburl}");' class='thumb'>
            <colgroup><col>
            </colgroup>
            <tbody>
            <tr><td>
                    <div class='title'>
                                {% autoescape off %}
                                    ${getShort(name,20)}
                                {% endautoescape  %}
                        </div></td></tr>
            <tr><td>
                    <div style=';background-image: url({{MEDIA_URL}}images/transparent-white.png); position:relative' >
                          <div>Size: ${size}</div>
                          <div style='font-size: x-small;'>Type</div>
                          <div style='font-size: xx-small;text-align: center'>${mimetype}</div>
                          <div style='font-size: x-small;'>Created: ${created}</div>
                          <div style='font-size: x-small;'>Updated: ${updated}</div>
                          <div style='font-size: xx-small;'>Checksum:</div>
                          <div style='font-size: xx-small;text-align: center;'>${checksum}</div>
                      </div>
                </td></tr>
            </tbody>
        </table>
    </div>
</div>
</script>


<script id="mfileChooserTemplate" type="text/x-jquery-tmpl">
<div id="${id}" class="infoholder mfile-chooser">
    <div  class='fluid' >
            <table cellpadding='0' cellspacing='0' style='' class='thumb'>
            <colgroup><col>
            </colgroup>
            <tbody>
            <tr>
                <td>
                    <div class='title'>Choose</div>
                </td>
            </tr>
            <tr>
                <td>
                   <div style=';background-image: url({{MEDIA_URL}}images/transparent-white.png); position:relative' >
                       <button >Choose</button>
                   </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
</script>

<script id="importdialogTemplate" type="text/x-jquery-tmpl">
    <div id="import-dialog-form" title="Import Data">
        <p id="import-dialog-items"></p>
    </div>
</script>

<script id="dialogTemplate" type="text/x-jquery-tmpl">
    
    <div id="${id}" title="${title}">
        <form>
            <div  class="ui-widget" style="margin: 2px;">
                <div class="ui-corner-all" style="padding: 0 .1em;">
                    <p>${message}</p>
                </div>
            </div>
        </form>
    </div>

</script>

<script id="jobSubmitTemplate" type="text/x-jquery-tmpl">
        <div  class="ui-corner-all " style="display: block">
            <div class="ui-widget ui-widget-content ui-corner-all ui-accordion ui-widget ui-helper-reset ui-accordion-icons"
                 style="margin: 10px;padding: 5px;width: 250px;border: 1px outset silver;">
                <h3 class="red ui-accordion-header ui-helper-reset ui-state-default ui-corner-all" style="font-size: 14px;padding: 4px;margin:3px"
                    role="tab" aria-expanded="false" tabindex="-1">New Job Form</h3>
                <span id="job-input-preview"></span>
                <span id="job-extra-input-preview"></span>
                {% templatetag openvariable %}tmpl( {"message":"Choose a job type from the menu."} ) "#messageTemplate" {% templatetag closevariable %}
                <form id="new-job-form" style="clear: both;">
                <input style="width:300px" id="serviceid" value="" type="hidden" name="serviceid" />
                <input style="width:300px" id="mfileid" value="" type="hidden" name="mfileid" />
                <fieldset>

                        <label for="jobtype">Job</label>
                        <select name="jobtype" class="jobtype ui-widget-content ui-corner-all" ></select>

                        <fieldset name="inputs" class="inputs">
                            <!-- Filled dynamically -->
                        </fieldset>

                        <label for="args">Arguments</label>
                        <div class="argsmessage" ></div>
                        <fieldset name="args" class="args">

                        </fieldset>
                </fieldset>
                </form>
                <button class="jobsubmit">Create Job</button>
            </div>
        </div>
</script>

<script id="jobOutputTemplate" type="text/x-jquery-tmpl">
    <table border="0" class="fluid">
        <tr><th colspan="2">${name}</th></tr>
        <tr>
            <td colspan="2">
                {%templatetag openvariable%}if thumburl != "" {%templatetag closevariable%}
                    <a  target='_blank' href='/joboutputs/${id}/file/' ><img id="joboutput-${id}" src='${thumburl}' /></a>
                {%templatetag openvariable%}else{%templatetag closevariable%}
                    <a target='_blank' href='/joboutputs/${id}/file/' style="color:green;font-weight: bold;font-variant: small-caps;font-size: large" >Download Output</a>
                {%templatetag openvariable%}/if{%templatetag closevariable%}
            </td>
        </tr>
        <tr><td><label for="joboutput-${id}-createmfile-name">Save as new file</label></td></tr>
        <tr>
            <td><input id="joboutput-${id}-createmfile-name" value="${name}" /></td>
            <td><button id="joboutput-${id}-createmfile-button">Save file</button></td>
        </tr>
    </table>
</script>

<div style="display:none">

    <div id="dialog-choose-mfile-dialog-form" title="Choose Mfile">
        <p>Choose an MFile<p>
        <div id="dialog-choose-mfile-mfileholder"></div>
    </div>

    <div id="dialog-form" title="Create New Render">
	<p class="validateTips">Input start frame and end frame.</p>

        <form>
	<fieldset>
		<label for="name">Start</label>
		<input type="text" name="start" id="start" class="text ui-widget-content ui-corner-all" />
		<label for="email">End</label>
		<input type="text" name="end" id="end" value="" class="text ui-widget-content ui-corner-all" />
	</fieldset>
	</form>
    </div>

    <div id="dialog-add-role-dialog-form" title="Add Role">
	<p class="validateTips">Input the method name.</p>

        <form>
	<fieldset>
		<label for="name">Methods</label>
		<input type="text" name="methods" id="methods" value="" class="text ui-widget-content ui-corner-all" />
	</fieldset>
	</form>
    </div>

    <div id="dialog-add-methods-dialog-form" title="Share">
	<p class="validateTips">Share methods.</p>

        <form>
	<fieldset>
		<label for="authmethods">Methods</label>
		<input type="text" name="authmethods" id="authmethods" value="" class="text ui-widget-content ui-corner-all" />
	</fieldset>
	</form>
    </div>

    <div id="dialog-new-job-dialog-form" title="New Job">
        <span id="job-input-preview"></span>
        <span id="job-extra-input-preview"></span>
        <form id="new-job-form" style="clear: both;">
            
            <!-- Can only support 1 input -->
            <!--<label for="serviceid">Service</label>-->
            <input style="width:300px" id="serviceid" value="" type="hidden" name="serviceid" />
            <!--<label for="mfile">MFile</label>-->
            <input style="width:300px" id="mfileid" value="" type="hidden" name="mfileid" />
	<fieldset>

		<label for="jobtype">Job</label>
                <select name="jobtype" id="jobtype"></select>

                <fieldset name="inputs" id="inputs">
                    <!-- Filled dynamically -->
                </fieldset>
                
                <label for="args">Arguments</label>
                <div id="argsmessage" ></div>
                <fieldset name="args" id="args">
                    
                </fieldset>
	</fieldset>
	</form>
        <button type="submit">Create Job</button>
    </div>

   <div id="dialog-mfile-dialog" title="Delete the file?">
        <p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>This item will be permanently deleted and cannot be recovered. Are you sure?</p>
    </div>

    <div id="dialog-job-dialog" title="Delete The Job?">
        <p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>This item will be permanently deleted and cannot be recovered. Are you sure?</p>
    </div>

</div>
{% extends "base.html" %}

{% block title %}MServe Container{% endblock %}

{% load mservetags %}

{% block usages %}
    {% if user.is_staff %}
               {% if usagesummary %}
                    {% for usagesummary in usagesummary %}
                        {% if usagesummary.metric == "http://mserve/disc_space" %}
                            <span>Largest File:&nbsp;&nbsp;<em>{{usagesummary.max|filesizeformat}}</em>&nbsp;&nbsp;&nbsp;</span>
                            <span>Average File Size:&nbsp;&nbsp;<em>{{usagesummary.avg|filesizeformat}}</em>&nbsp;&nbsp;&nbsp;</span>
                            <span>Disc Space Used:&nbsp;&nbsp;<em>{{usagesummary.sum|filesizeformat}}</em>&nbsp;&nbsp;&nbsp;</span>
                        {% endif %}
                        {% if usagesummary.metric == "http://mserve/responsetime" %}
                            <span>Average Response Time&nbsp;&nbsp;<em>{{usagesummary.avg}}s</em>&nbsp;&nbsp;&nbsp;</span>
                        {% endif %}
                        {% if usagesummary.metric == "http://mserve/file" %}
                            <span>Files&nbsp;&nbsp;<em>{{usagesummary.n}}</em>&nbsp;&nbsp;&nbsp;</span>
                        {% endif %}
                        {% if usagesummary.metric == "http://mserve/service" %}
                            <span>Services&nbsp;&nbsp;<em>{{usagesummary.n}}</em>&nbsp;&nbsp;&nbsp;</span>
                        {% endif %}
                    {% endfor %}
            {% endif %}
    {% endif %}

{% endblock %}

{% block content %}

<div id="service-dialog" title="Service dialog" style="display: none">
    <form id="service-form" style="width: 200px;height: 100%;" >
           {{ serviceform.as_p }}
    </form>
</div>

<div id="subservice-dialog" title="Service dialog" style="display: none">
    <form id="subservice-form" style="width: 200px;height: 100%;" >
           {{ subserviceform.as_p }}
    </form>
</div>

<div id="tabs">

    <ul>
        <li><a href="#tabs-1">Services</a></li>
        <li><a href="#tabs-3">Config</a></li>
        <li><a href="#tabs-usage">Usage</a></li>
        <li><a href="#tabs-5">Access Control</a></li>
    </ul>

    <div id="tabs-1">
        <div class="paginator" id="servicepaginator"></div>
        <div id="servicemessages" style="clear:both"></div>

        <button id="createservicebutton" >New Service</button>

        <script type="text/javascript">
            $(document).ready(function() {
                loadServices('{{ container.id }}');
                $("#createservicebutton" ).button().click(function() {  create_service('{{ container.id }}') });
            });
        </script>
    </div>

    <div id="tabs-3">
         {% if user.is_staff %}

            <h3>Container Configuration</h3>

            <div style="width:500px;">
                <form id="containerupdateform" action="/services/{{service.id}}/mfiles/" method="POST"  style="width: 100%;height: 100%;" >
                {{ hcform.as_p }}
                </form>
                <button id="containerupdatebutton">Update</button>

                <script type="text/javascript">
                    $(document).ready(function() {
                        $("#containerupdatebutton" ).button().click(function() {  update_container('{% url hostingcontainer container.id %}') });
                    });
                </script>

            </div>

            <h3>Management Properties</h3>

            <table style="table-layout: fixed;width:300px;">
                <tr><th>Name</th><th>Value</th><th><!--Actions--></th></tr>
                {% for property in properties%}
                <tr><td>{{ property.property }}</td><td>{{property.value }}</td></tr>
                {% endfor %}
            </table>

        {% endif %}

    </div>
    <div id="tabs-usage">

        {% include "usage.html" %}
    </div>
    <div id="tabs-5">
        {% include "auths.html" %}
    </div>
</div>

{% endblock %}

{% block rightcontent %}

{% endblock rightcontent %}

{% block bottomcontent %}

{% endblock %}





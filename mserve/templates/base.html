<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
{% block script %}{% endblock %}
<script type="text/javascript" src="/mservemedia/js/jquery-1.4.3.js" ></script>
<script type="text/javascript">

     function deletestager(stagerid){
         $.ajax({
           type: "DELETE",
           url: '/stager/'+stagerid+"/",
           success: function(msg){
             alert( "Deleted " + window.location );
             window.location.replace("/");
           },
           error: function(msg){
             alert( "Failure On Delete " + msg );
           }
         });
     }

     function poplulate_methods(roleid, methods){
           $('.methods'+roleid).empty()
           $.each(methods, function(i,item){
                id = $("<a href='#'>"+item+"&nbsp;</a>&nbsp;")
                $(id).appendTo('.methods'+roleid);
           });
     }

     function addAuthMethod(roleid){
        var methods = prompt("What methods do you wish to add\nComma separated", "");
        if (methods == null)
            return;
        if (methods == "")
            return;
        $.ajax({
           type: "PUT",
           url: '/roles/'+roleid+"/",
           data: "methods="+methods,
           success: function(msg){
               poplulate_methods(roleid,msg["methods"])
           },
           error: function(msg){
             alert( "Failure to add methods '" + methods + "'\nStatus: '" + msg.status+ "'\nResponse Text:\n" + msg.responseText);
           }
         });
     }

</script>
<style type="text/css" media="screen">
body {
    background: #e7e7e7;
    font-family: Tahoma, sans-serif;
    font-size: 10pt;
    text-align:center;
}
#wrapper {
        margin: 0 auto;
        width: 95%;
        text-align:left;
}

h1,h2,h3,h4,h5,h6 {
    color:#0000AA;
    margin:2px;
    font-variant: small-caps;
}

h2 {
    color:#0000AA;
    font-variant: small-caps;
}

a, a:visited {
    text-decoration: none;
    border:none;
    color:#AA0000;
}
a img {
    border:none;
}

.ascript {
    text-decoration: none;
    border:none;
    color:#00AA00;
    cursor: pointer;
}

td {
    vertical-align: top;
}

#sidebar {
    vertical-align: top;
    margin-top: 20px;
    padding: 15px;

}

#maintable{
    padding:4px;
}

.auth {
    margin: 2px;
    padding: 3px;
    border:2px outset silver;
}

dt{
    color:#660000;
}

.authname {
    padding:2px;
    margin-top: 5px;
    font-weight: bold;
    font-size: 16px;
}
.method, .authid {
    padding:6px;
}
.table_usage th,.table_usage td {
    padding:1px;
    text-align: left;
}
.table_usage th {
    text-align: right;
    border:1px outset gray;
    background-color: #EEEEEE;
    padding-left: 3px;
    min-width: 50px;
}
.table_usage td {
    text-align: right;
}

.errorlist li {
    font-weight: bold;
    color: red;
}
dt {
    font-weight: bold;
}
.highlight{
    color:red;
}

.failed,.passed{
    width: 50%;
    border: 1px outset black;
    padding: 10px;
}
.failed {   
    background-color: #CC0000;
    color: white;
}
.passed {
    background-color: #336600;
    color: white;
}
</style>
    <!--<link rel="stylesheet" href="style.css" />-->
    <title>{% block title %}MServe{% endblock %}</title>
</head>

<body id="wrapper">

    <h2>{% block heading %}MServe{% endblock %}</h2>
    <table id="maintable">
        <tr>
            
            <th id="sidebar" width="10%" rowspan="3" >
                
                {% block sidebar %}
                {% if user.is_staff %}
                    <div><a href="/home/">Home</a></div>
                    <div><a href="/admin/">Admin</a></div>
                    <div><a href="/usage/">Usage</a></div>
                    <div><a href="/map/">Map</a></div>
                    <div><a href="/viz/">Vizualizations</a></div>
                {% endif %}

                {% if user.is_authenticated %}
                <div><a href="/accounts/profile/">Profile</a></div>
                <div><a href="/accounts/logout/">Logout</a></div>
                {% endif %}

                {% if not user.is_authenticated %}
                <!--<div><a href="/accounts/login/">Login</a></div>-->
                {% endif %}

                {% endblock %}

            </th>
            
            <td >
                {% block content %}{% endblock %}
            </td >
            <td style="max-width: 20em">
                {% block rightcontent %}

                {% endblock %}

                {% block auths %}
                <h3>Auths</h3>
                {% if auths %}
                    {% for auth in auths %}
                    <dl class="auth">
                        <dt >Authority Name</dt>
                        <dd >{{auth.authname}}</dd>
                        <dt >Auth ID</dt>
                        <dd ><a href="/auth/{{auth.id}}/">{{auth.id}}</a></dd>

                        {%  for role in auth.roles.all %}
                        <dt >Role: {{role.rolename}}</dt>
                        <dd ><em>{{role.description}}</em></dd>
                        <dd class="methods{{role.id}}">
                            {% if container %}
                                {% for method in role.methods %}<a href="/containerapi/{{method}}/{{container.id}}/" >{{method}}</a>
                            {% endfor %}
                            {% endif %}
                            {% if service %}
                                {% for method in role.methods %}<a href="/serviceapi/{{method}}/{{service.id}}/" >{{method}}</a>
                            {% endfor %}
                            {% endif %}
                            {% if stager %}
                                {% for method in role.methods %}<a href="/stagerapi/{{method}}/{{stager.id}}/" >{{method}}</a>
                            {% endfor %}
                            {% endif %}
                        </dd>
                        <dd><a class="ascript" onclick="javascript:addAuthMethod('{{role.id}}');">Add Method</a>
                        </dd>
                        {% endfor %}
                    </dl>
                    {% endfor %}
                {% endif %}

                {% if not auths%}
                    <div>None</div>
                {% endif %}
                {% endblock auths %}
            </td>
        </tr>
        <tr>
            <td colspan="2">
                {% block bottomcontent %}
                {% endblock %}
            </td>
        </tr>

    </table>
</body>
</html>
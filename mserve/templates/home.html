{% extends "base.html" %}

{% block title %}MServe Home{% endblock %}

{% block usages %}
    {% if user.is_staff %}
                    {% if usagesummary %}
                    {% for usagesummary in usagesummary %}
                        {% if usagesummary.metric == "http://mserve/disc_space" %}
                            <span>Largest File:&nbsp;&nbsp;<em>{{usagesummary.max|filesizeformat}}</em>&nbsp;&nbsp;&nbsp;</span>
                            <span>Average File Size:&nbsp;&nbsp;<em>{{usagesummary.avg|filesizeformat}}</em>&nbsp;&nbsp;&nbsp;</span>
                            <span>Disc Space Used:&nbsp;&nbsp;<em>{{usagesummary.sum|filesizeformat}}</em>&nbsp;&nbsp;&nbsp;</span>
                        {% endif %}
                        {% if usagesummary.metric == "http://prestoprime/responsetime" %}
                            <span>Average Response Time&nbsp;&nbsp;<em>{{usagesummary.avg}}s</em>&nbsp;&nbsp;&nbsp;</span>
                        {% endif %}
                        {% if usagesummary.metric == "http://mserve/container" %}
                            <span>Containers&nbsp;&nbsp;<em>{{usagesummary.n}}</em>&nbsp;&nbsp;&nbsp;</span>
                        {% endif %}
                        {% if usagesummary.metric == "http://mserve/service" %}
                            <span>Services&nbsp;&nbsp;<em>{{usagesummary.n}}</em>&nbsp;&nbsp;&nbsp;</span>
                        {% endif %}
                        {% if usagesummary.metric == "http://mserve/file" %}
                            <span>Files&nbsp;&nbsp;<em>{{usagesummary.n}}</em>&nbsp;&nbsp;&nbsp;</span>
                        {% endif %}
                    {% endfor %}
            {% endif %}
    {% endif %}
{% endblock %}

{% block content %}

    {% if user.is_staff %}

            <h3>Containers</h3>

            <div class="paginator" id="containerpaginator"></div>
            <div style="clear:both" id="containermessages"></div>

            <button id="createcontainerbutton" >New Container</button>

            <script type="text/javascript">
                $(document).ready(function() {
                    loadContainers();
                    $("#createcontainerbutton" ).click(function() {  create_container() });
                });
            </script>

    {% else %}

        {% if not user.is_authenticated %}
            <p>Welcome, Please <a href="/accounts/login" >log in.</a></p>
        {% else %}

    {% endif %}


{% endif %}

        {% if user.is_authenticated %}
        <h1>Resources you own</h1>

            <div id="user_mfilemessages">

            </div>


            <div id="user_mfileholder">

            </div>

        <h1>Resources you have access to</h1>

            <div id="user_authmessages">

            </div>
        
            <div id="user_authholder">

            </div>

        <div class="clr"></div>

        <table style="table-layout: fixed;width: 100%">
            <tr>
                {% if not user.is_staff %}
                <td>
                    <h1>Request a Service</h1>

                    <div id="user-request-service" >
                        <form id="user-request-service-form"  >
                            <div id="user-request-service-form-errors" style="color:red;font-weight: bold"></div>
                            {{ servicerequestform.as_p }}

                        </form>
                        <button id="user-request-service-button"  >Request a Service</button>
                    </div>
                </td>
                {% endif %}
                <td >
                    <h1>Pending Requests</h1>
                    <div id="pending-requests" style="height: 150px;overflow: auto;">
                        
                    </div>
                </td>
                <td>
                    <h1>Requests</h1>
                    <div id="done-requests" style="height: 150px;overflow: auto;">

                    </div>
                </td>
            </tr>
        </table>

        <div class="clr"></div>
    {% endif %}

{% endblock %}

{% block auths %}

{% endblock auths %}

{% block bottomscript %}
  {% if user.is_authenticated %}
    {% if user.is_staff %}
    <script type="text/javascript">
        isStaff= true
    </script>
    {% else %}
    <script type="text/javascript">
        isStaff= false
    </script>
    {% endif %}
    <script type="text/javascript">

        $(document).ready(function() {
                $('button').button();
                $('#user-request-service-button').click( function(){
                    user_request_service("{% url user_requests %}")
                });
                load_user("{% url user %}","{% url consumer %}","#mfileTemplate");
                load_user_requests("{% url user_requests %}");
        });
    </script>
  {% endif %}
{% endblock %}